!function(t){var e,a,o;t("#subjectList li").each((function(){var e=t(".taxo-flag").outerWidth(!0),a=t(this).width()-e,i=a-10,n=t(this).find(".taxo-term"),c=t(n).next();if(t(n).width()>i)var l=t(n).css("width",a+"px");if(o=t(c).next().data("categoryname"),void 0!==localStorage[o])var r=t(c).addClass("flagged");return{term_flagged:r,term_truncate:l}})),e=function(){var e;e=t(this).next(),t(e).addClass("activate"),t(e).parent().siblings().children("div").hasClass("activate")&&(t(e).parent().siblings().children("div").removeClass("activate"),window.clearTimeout(closeIt)),t(document).on("click.closeOutside",(function(a){1!==t(a.target).closest(".taxo-flag").length&&1!==t(a.target).closest(".taxo-tooltip").length&&(t(e).removeClass("activate"),t(document).off("click.closeOutside"))}))},t(".taxo-flag").on("click",e),a=void t(".taxo-tooltip button").on("click",(function(){var e,o,i,n,c;n=t(this).parent().parent(),o=t(n).data("categoryname"),e=t(n).prev(),c=t("meta[name='dc.identifier']").attr("content"),i=t(this).data("action"),t.ajax({type:"POST",url:siteUrlPrefix+"taxonomy/flag/"+i,data:{categoryTerm:o,articleDoi:c},error:function(e){t("#subjectErrors").append(e)},success:function(){"remove"===i?t(e).removeClass("flagged"):t(e).addClass("flagged")}}),"add"===i?localStorage.setItem(o,c):localStorage.removeItem(o,c),t(this).parent().toggle().next().toggle(),window.setTimeout((function(){t(n).removeClass("activate"),t(n).children(".taxo-explain").toggle(),t(n).children(".taxo-confirm").toggle(),t(".taxo-flag").on("click",a)}),1e3)}))}(jQuery);