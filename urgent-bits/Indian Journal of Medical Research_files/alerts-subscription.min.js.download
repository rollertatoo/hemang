"use strict";var ejpAlerts=ejpAlerts||{};ejpAlerts.errors=ejpAlerts.errors||{},ejpAlerts.alertType={etoc:"etoc",pap:"pap"},ejpAlerts.errors.email={invalid:"This is not a valid email address, please try again."},Object.freeze(ejpAlerts.alertType),Object.freeze(ejpAlerts.errors.email),ejpAlerts.isEmailValid=function(e){return/^(([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})$/.test(e)},ejpAlerts.isValidAlertType=function(e){return e&&ejpAlerts.alertType.hasOwnProperty(e.toLowerCase())},ejpAlerts.subscribeToAlert=function(e,t,r,s,a){if(e&&!ejpAlerts.isEmailValid(e))s(ejpAlerts.errors.email.invalid);else if(ejpAlerts.isValidAlertType(t)){const l="".concat(window._spPageContextInfo&&window._spPageContextInfo.siteAbsoluteUrl||"","/_layouts/OAKS.Journals/AlertsSubscribionService.svc/SubscribeToAlert"),i="An error occured while subscribing to the alert.";let o={data:{}};e&&(o.data.email=e),a&&(o.data.setContextUrlAsDefaultPage=a),o.data.alertType=t,$.ajax({type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(o),url:l,success:function(e){if(2===e.status)return console.error("An error occured while subscribing to ".concat(t,".")),void s(e.message);r()},error:function(e,t,r){console.error(i),s(i)}})}else s("Alert Type is invalid.")},window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".js-section-alert");if(e)for(let t=0;t<e.length;t++){const r=e[t],s=r.querySelector(".js-section-alert__content"),a=r.querySelector(".js-section-alert__subscribe-button"),l=r.querySelector(".js-section-alert--error"),i=a.getAttribute("data-alert-type"),o=a.getAttribute("data-subscribed-msg"),n=()=>{s.textContent=o,l.classList.contains("dn")||l.classList.add("dn")},c=e=>{l.textContent=e,l.classList.contains("dn")&&l.classList.remove("dn")};a.addEventListener("click",e=>{let t=r.querySelector(".js-section-alert__email"),s=!0,a=null;if(t&&(a=t.value,ejpAlerts.isEmailValid(a)||(s=!1,c(ejpAlerts.errors.email.invalid))),s){let e=!!a;ejpAlerts.subscribeToAlert(a,i,n,c,e)}e.stopPropagation(),e.preventDefault()})}}),(e=>{e(()=>{e(".js-subscribe-to-alerts-container").each((t,r)=>{const s=e(r);s.find(".js-subscribe-to-alerts-btn").on("click",t=>{const r=e(t.target),a=r.data("alert-type"),l=r.data("subscribed-msg");ejpAlerts.subscribeToAlert(null,a,function(){r.hide(),s.find(".js-subscribe-to-alerts-body-text").text(l)},function(e){console.error("Exception occurs during subscribing to ".concat(a,"."))}),t.preventDefault(),t.stopPropagation()})})})})(jQuery);